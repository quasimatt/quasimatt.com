<html>
<head>
  <base target="_blank">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="https://pbs.twimg.com/profile_images/1614420813800767490/mf6sQbCT_400x400.jpg" type="image/png">
  <link rel="manifest" href="/manifest.json">
</head>

<body>

  <p><strong>quasimatt.com wrapped 2025</strong></p>

  <p>
    @<input
      id="handleInput"
      type="text"
      placeholder="enter your x handle"
      list="handleSuggestions"
      autocomplete="off"
      style="border:none; outline:none; font:inherit; width:16ch;"
    />
    <span id="goHint" style="opacity:0.6;">↵</span>
  </p>

  <datalist id="handleSuggestions"></datalist>

  <div id="content"></div>

  <script>
    let PEOPLE = null;
    let HANDLES = [];

    fetch("/social/wrapped2025/wrapped2025_people.json")
      .then(r => r.json())
      .then(data => {
        PEOPLE = data;
        HANDLES = Object.keys(data);

        const list = document.getElementById("handleSuggestions");
        HANDLES.forEach(h => {
          const opt = document.createElement("option");
          opt.value = h;
          list.appendChild(opt);
        });

        const handleFromURL = getHandleFromURL();
        if (handleFromURL) {
          document.getElementById("handleInput").value = handleFromURL;
          render(handleFromURL);
        } else {
          renderOverview();
        }
      });

    function getHandleFromURL() {
      const q = window.location.search.replace("?", "").trim();
      return q || null;
    }

    function renderOverview() {
      document.getElementById("content").innerHTML = `
        <p>wow. 2025 sure was interesting. here's what's happened on quasimatt.com since 9/22/25.</p>

        <p>
          over 89 days, 210 individual people were mentioned.
          on average, people were mentioned on 4.7 days.
          112 people appeared only once.
          the most social day was halloween (33 people).
          the busiest days were friday and saturday.
          the strongest pair was mihir and jacob.
          the word “queen” appeared 54 times.
        </p>

        <p>
          enter your handle above to see how you fit into it.
        </p>
      `;
    }

    function renderWrapped(handle) {
      const data = PEOPLE[handle];

      if (!data) {
        return `
          <p><strong>@${handle}</strong></p>
          <p>
            you were mentioned on quasimatt.com, but not frequently enough
            to receive a wrapped this year.
          </p>
          <p>
            maybe next year.
          </p>
        `;
      }

      const topConnections = data.top_connections
        .map(c => `@${c.handle}`)
        .join(", ");

      return `
        <p><strong>@${handle}</strong></p>

        <p>
          you were mentioned on <strong>${data.days_seen}</strong> days,
          placing you in the <strong>${data.days_seen_percentile}th percentile</strong>.
        </p>

        <p>
          you appeared with <strong>${data.connections}</strong> different people.
        </p>

        <p>
          lately, our trajectory is <strong>${data.friendship_trend.label}</strong>.
        </p>

        <p>
          when you show up, it’s usually in
          <strong>${data.social_style.replace("_", " ")}</strong> hangs
          (avg group size: ${data.avg_group_size}).
        </p>

        <p>
          we most often crossed paths on <strong>${data.top_weekday}</strong>s.
        </p>

        <p>
          you most often appeared alongside ${topConnections}.
        </p>
      `;
    }

    function render(handle) {
      const clean = handle.replace(/^@/, "").toLowerCase();
      window.history.pushState({}, "", `?${clean}`);
      document.getElementById("content").innerHTML = renderWrapped(clean);
    }

    document.getElementById("handleInput").addEventListener("keydown", e => {
      if (e.key === "Enter") {
        e.preventDefault();
        render(e.target.value);
      }
    });
  </script>

</body>
</html>
