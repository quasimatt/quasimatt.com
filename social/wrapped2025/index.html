<html>
<head>
  <base target="_blank">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="https://pbs.twimg.com/profile_images/1614420813800767490/mf6sQbCT_400x400.jpg" type="image/png">
  <link rel="manifest" href="/manifest.json">
</head>

<body>

  <p>quasimatt.com wrapped 2025</p>

  <p>
    @<input
      id="handleInput"
      type="text"
      placeholder="username"
      list="handleSuggestions"
      autocomplete="off"
      style="border:none; outline:none; font:inherit; width:16ch;"
    />
  </p>

  <datalist id="handleSuggestions"></datalist>

  <!-- OVERVIEW (UNCHANGED COPY) -->
  <div id="overview">
    <p>wow. 2025 sure was interesting. here's what's happened on quasimatt.com since 9/22/25.</p>

    <p>
      over 89 days, 210 individual people were mentioned on quasimatt.com.
      on average, people were mentioned on 4.7 days.
      112 people were mentioned only once.
      the day with the most mentions was 10/31 (halloween), with 33 people mentioned.
      the most social week mentioned 57 people.
      the least social week mentioned 10.
      an average of 6.5 people were mentioned per day,
      with the busiest days being saturday and friday and the quietest day being sunday.
      the strongest co-mentioned pair was mihir and jacob.
      the strongest co-mentioned trio was cass, maisy, and kathy.
      the most mentioned person was mihir, who appeared with 116 different people.
      the longest mention streak was john, who was mentioned 8 days in a row.
      the word "queen" appeared on quasimatt.com 54 times in 2025.
    </p>
  </div>

  <!-- PERSONAL WRAPPED -->
  <div id="result"></div>

  <script>
    let PEOPLE = null;
    let IDENTITIES = {};

    function normalizeHandle(raw) {
      return raw.trim().replace(/^@/, "").toLowerCase();
    }

    Promise.all([
      fetch("/social/wrapped2025/wrapped2025_people.json").then(r => r.json()),
      fetch("/social/wrapped2025/names.json").then(r => r.json())
    ]).then(([peopleData, identityData]) => {
      PEOPLE = peopleData;
      IDENTITIES = identityData;

      const list = document.getElementById("handleSuggestions");
      Object.keys(peopleData).forEach(h => {
        const opt = document.createElement("option");
        opt.value = h;
        list.appendChild(opt);
      });

      // ✅ FIX: read raw ?handle (not URLSearchParams)
      const handleFromURL = window.location.search.slice(1);
      if (handleFromURL) {
        document.getElementById("handleInput").value = handleFromURL;
        renderWrapped(handleFromURL);
      }
    });

    function personLink(handle) {
  const h = handle.replace(/^@/, "").toLowerCase();
  const identity = IDENTITIES[h];

  // identity is already an <a>...</a> string
  if (!identity) return `@${h}`;

  return identity;
}


    function topPercentile(p) {
      const v = Math.max(0.1, 100 - p);
      return v < 1 ? `${v.toFixed(1)}%` : `${Math.round(v)}%`;
    }

    function renderWrapped(raw) {
      if (!PEOPLE) return;

      const handle = normalizeHandle(raw);
      const data = PEOPLE[handle];

      document.getElementById("overview").style.display = "none";
      window.history.pushState({}, "", `?${handle}`);

      if (!data) {
        document.getElementById("result").innerHTML = `
          <p><strong>${personLink(handle)}</strong> — you have to be mentioned on at least 3 days to get a personalized wrapped. get your clout up.</p>
        `;
        return;
      }

      const topDaysPct = topPercentile(data.days_seen_percentile);
      const topConnectionsPct = topPercentile(data.connections_percentile);

      function formatList(items) {
  if (items.length === 1) return items[0];
  if (items.length === 2) return `${items[0]} and ${items[1]}`;
  return `${items.slice(0, -1).join(", ")}, and ${items.at(-1)}`;
}

const topConnections = formatList(
  data.top_connections.map(c => personLink(c.handle))
);


      let socialLine = "";
      if (data.social_style === "partygoer") {
        socialLine = "basically, you only see each other at parties.";
      } else if (data.social_style === "normie") {
        socialLine = "that's pretty normal.";
      } else {
        socialLine = "you're either in the inner circle, or always catch him on his anti-social days.";
      }

      document.getElementById("result").innerHTML = `
        <p>
          <strong>${personLink(handle)}</strong> — you were mentioned on <strong>${data.days_seen}</strong> days, placing you in the top <strong>${topDaysPct}</strong>. you are connected to <strong>${data.connections}</strong> different people, which means you're in the top <strong>${topConnectionsPct}</strong> most connected. you are most connected to ${topConnections}. the person farthest away from you on the social graph is <strong>${personLink(data.most_distant_person.handle)}</strong>. over time, your friendship with quasimatt has been <strong>${data.friendship_trend.label}</strong>. when quasimatt sees you, he sees an average of <strong>${data.avg_group_size}</strong> other people that day. ${socialLine} based on advanced social analysis technology and the wealth of data on quasimatt.com, you are likely <strong>${data.orientation}</strong>.
        </p>
      `;
    }

    const input = document.getElementById("handleInput");

    input.addEventListener("keydown", e => {
      if (e.key === "Enter") {
        e.preventDefault();
        renderWrapped(e.target.value);
      }
    });

    input.addEventListener("change", e => {
      renderWrapped(e.target.value);
    });
  </script>

</body>
</html>

