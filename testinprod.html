<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>quasi – slides (erase → scroll)</title>
  <style>
    html, body { height:100%; margin:0; background:#000; }
    body { font-family: "Helvetica Neue", Helvetica, Arial, system-ui, -apple-system, sans-serif; }
    canvas { display:block; width:100%; height:100%; }
  </style>
</head>
<body>
  <canvas id="stage" aria-label="Interactive text canvas"></canvas>
  <script>
  (function(){
    // ------- Common setup -------
    var stage = document.getElementById('stage');
    var ctx = stage.getContext('2d');
    var dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));

    function setSize(){
      stage.width = Math.floor(innerWidth * dpr);
      stage.height = Math.floor(innerHeight * dpr);
      stage.style.width = innerWidth + 'px';
      stage.style.height = innerHeight + 'px';
    }
    setSize();
    addEventListener('resize', setSize, {passive:true});

    var now = 0, last = 0;

    // ------- Slide Manager -------
    var slideIndex = 0; // 0 = erase, 1 = scroll
    function nextSlide(){
      slideIndex = (slideIndex + 1);
      if (slideIndex === 1) slide2_init();
    }

    // =====================================
    // Slide 0 — Erase-to-clear (white text on black)
    // =====================================
    var s0 = {
      textCanvas: document.createElement('canvas'),
      tctx: null,
      probe: document.createElement('canvas'),
      pctx: null,
      dirty: true
    };
    s0.tctx = s0.textCanvas.getContext('2d');
    s0.pctx = s0.probe.getContext('2d', { willReadFrequently: true });
    s0.probe.width = 160; s0.probe.height = 90;

    var MAIN = "together";
    var SUB  = "by quasimatt";

    function s0_resize(){
      s0.textCanvas.width = stage.width;
      s0.textCanvas.height = stage.height;
      s0_drawText();
      s0.dirty = true;
    }

    function wrapLines(ctx2, text, font, maxWidth){
      ctx2.font = font;
      var words = text.split(/\s+/);
      var lines = []; var line = '';
      for (var i=0;i<words.length;i++){
        var test = line ? (line + ' ' + words[i]) : words[i];
        if (ctx2.measureText(test).width <= maxWidth || !line) line = test;
        else { lines.push(line); line = words[i]; }
      }
      if (line) lines.push(line);
      return lines;
    }

    function s0_drawText(){
      var W = s0.textCanvas.width, H = s0.textCanvas.height;
      var tctx = s0.tctx;
      tctx.setTransform(1,0,0,1,0,0);
      tctx.clearRect(0,0,W,H);

      var mainSize = Math.max(26, Math.min(120, Math.floor(W * 0.055)));
      var subSize  = Math.max(12, Math.min(34,  Math.floor(W * 0.02)));

      tctx.fillStyle = '#fff';
      tctx.textAlign = 'center';
      tctx.textBaseline = 'middle';

      var mainFont = '700 ' + mainSize + 'px "Helvetica Neue", Helvetica, Arial, system-ui, -apple-system, sans-serif';
      var subFont  = '400 ' + subSize  + 'px "Helvetica Neue", Helvetica, Arial, system-ui, -apple-system, sans-serif';

      var maxTextWidth = Math.floor(W * 0.8);
      var lines = wrapLines(tctx, MAIN, mainFont, maxTextWidth);
      var lineGap = Math.floor(mainSize * 0.35);
      var blockHeight = lines.length * mainSize + (lines.length - 1) * lineGap + (subSize * 1.6);
      var y = (H - blockHeight) / 2 + mainSize/2;

      tctx.font = mainFont;
      for (var j=0;j<lines.length;j++){ tctx.fillText(lines[j], W/2, y); y += mainSize + lineGap; }
      tctx.font = subFont;
      tctx.fillText(SUB, W/2, y + subSize*0.8);
    }

    function s0_paint(){
      ctx.setTransform(1,0,0,1,0,0);
      ctx.fillStyle = '#000';
      ctx.fillRect(0,0,stage.width,stage.height);
      ctx.drawImage(s0.textCanvas, 0, 0);
    }

    // brush = 50% larger than original, interpolated stamps for fast motion
    function s0_brushRadius(){
      var b = stage.width * 0.04 * 1.5;
      return Math.max(60, Math.min(240, Math.floor(b)));
    }
    function s0_eraseStamp(x,y,r){
      var g = s0.tctx.createRadialGradient(x, y, 0, x, y, r);
      g.addColorStop(0.0, 'rgba(0,0,0,1)');
      g.addColorStop(0.6, 'rgba(0,0,0,0.6)');
      g.addColorStop(1.0, 'rgba(0,0,0,0)');
      s0.tctx.globalCompositeOperation = 'destination-out';
      s0.tctx.fillStyle = g;
      s0.tctx.beginPath();
      s0.tctx.arc(x, y, r, 0, Math.PI*2);
      s0.tctx.fill();
      s0.tctx.globalCompositeOperation = 'source-over';
    }
    function s0_eraseLine(x0,y0,x1,y1){
      var r = s0_brushRadius();
      var dx = x1-x0, dy=y1-y0; var dist = Math.hypot(dx,dy);
      if (dist===0){ s0_eraseStamp(x1,y1,r); return; }
      var step = Math.max(1, r*0.5); // half-radius stepping to avoid gaps
      var n = Math.ceil(dist/step);
      for (var i=0;i<=n;i++){
        var t = i/n; s0_eraseStamp(x0+dx*t, y0+dy*t, r);
      }
    }
    function s0_allErased(){
      var pctx = s0.pctx;
      pctx.clearRect(0,0,s0.probe.width,s0.probe.height);
      pctx.drawImage(s0.textCanvas, 0, 0, s0.probe.width, s0.probe.height);
      var data = pctx.getImageData(0,0,s0.probe.width,s0.probe.height).data;
      for (var i=3;i<data.length;i+=4){ if (data[i]!==0) return false; }
      return true;
    }

    // pointer handling (only active on slide 0)
    var lastPt = null;
    function toPx(evt){ var r=stage.getBoundingClientRect(); return {x:(evt.clientX-r.left)*dpr, y:(evt.clientY-r.top)*dpr}; }
    stage.addEventListener('pointerdown', function(e){
      if (slideIndex!==0) return;
      var p=toPx(e); s0_eraseStamp(p.x,p.y,s0_brushRadius()); lastPt=p; try{stage.setPointerCapture(e.pointerId);}catch(_){}
    });
    stage.addEventListener('pointermove', function(e){
      if (slideIndex!==0) return;
      var p=toPx(e);
      if (lastPt) s0_eraseLine(lastPt.x,lastPt.y,p.x,p.y); else s0_eraseStamp(p.x,p.y,s0_brushRadius());
      lastPt=p;
    });
    ['pointerup','pointercancel','pointerleave','pointerout'].forEach(function(t){ stage.addEventListener(t, function(){ lastPt=null; }); });

    // =====================================
    // Slide 1 — Right-to-left sentence stream
    // =====================================
    var sentences = (
      "we got drunk on christmas. i told you i felt like the bar was too high. we can't know people the way we know ourselves. we feel lonely because we imagine a closeness we can never reach. we need to lower our standards."
    ).split('.').map(function(s){ return (s.trim()? s.trim()+'.' : '').trim(); }).filter(Boolean);

    var s2 = { items: [], lastSpawnedIndex: -1, lastY: -999, spawnedNext:false, speed: 120 }; // px/sec @ dpr=1

    function slide2_init(){
      s2.items.length = 0; s2.lastSpawnedIndex = -1; s2.lastY=-999; s2.spawnedNext=false;
      spawnNextSentence(true); // start immediately
    }

    function s2_fontSize(){ return Math.max(18, Math.min(42, Math.floor(stage.width * 0.02))); }

    function s2_pickY(){
      var margin = Math.max(40, Math.floor(stage.height*0.1));
      var y, tries=0;
      do {
        y = Math.floor(Math.random()*(stage.height - 2*margin)) + margin;
        tries++;
      } while (Math.abs(y - s2.lastY) < 40 && tries < 8);
      s2.lastY = y; return y;
    }

    function spawnNextSentence(initial){
      var next = (s2.lastSpawnedIndex + 1) % sentences.length;
      s2.lastSpawnedIndex = next;
      var text = sentences[next];
      var font = '400 ' + s2_fontSize() + 'px "Helvetica Neue", Helvetica, Arial, system-ui, -apple-system, sans-serif';
      ctx.font = font;
      var w = Math.ceil(ctx.measureText(text).width);
      var item = {
        text: text,
        font: font,
        x: stage.width + (initial? 0 : Math.floor(s2_fontSize()*0.5)), // small spacing
        y: s2_pickY(),
        w: w
      };
      s2.items.push(item);
      s2.spawnedNext = false;
    }

    function slide2_update(dt){
      // move left
      var speed = s2.speed * dpr;
      for (var i=0;i<s2.items.length;i++) s2.items[i].x -= speed * dt;

      // when tail of last item becomes visible, spawn next
      var lastItem = s2.items[s2.items.length-1];
      if (lastItem && !s2.spawnedNext && (lastItem.x + lastItem.w <= stage.width)){
        s2.spawnedNext = true;
        spawnNextSentence(false);
      }

      // remove items offscreen left
      while (s2.items.length && s2.items[0].x + s2.items[0].w < 0) s2.items.shift();
    }

    function slide2_render(){
      ctx.setTransform(1,0,0,1,0,0);
      ctx.fillStyle = '#000';
      ctx.fillRect(0,0,stage.width,stage.height);
      ctx.textAlign = 'left';
      ctx.textBaseline = 'middle';
      ctx.fillStyle = '#fff';
      for (var i=0;i<s2.items.length;i++){
        var it = s2.items[i];
        ctx.font = it.font;
        ctx.fillText(it.text, it.x, it.y);
      }
    }

    // ------- Frame loop -------
    function render(){
      if (slideIndex === 0){ s0_paint(); }
      else if (slideIndex === 1){ slide2_render(); }
    }

    function update(dt){
      if (slideIndex === 0){
        if (s0_allErased()) nextSlide();
      } else if (slideIndex === 1){
        slide2_update(dt);
      }
    }

    function resizeAll(){ s0_resize(); }
    resizeAll();

    function tick(ts){
      if (!last) last = ts; now = ts; var dt = Math.min(0.05, (now - last)/1000); last = now; // clamp dt
      update(dt);
      render();
      requestAnimationFrame(tick);
    }

    requestAnimationFrame(tick);
  })();
  </script>
</body>
</html>
